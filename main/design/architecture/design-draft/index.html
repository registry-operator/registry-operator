
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../..">
      
      
        <link rel="next" href="../../../getting_started/0-introduction/">
      
      
      <link rel="icon" href="../../../assets/package.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.39">
    
    
      
        <title>Design Draft - Registry Operator</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="326CE5" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Registry Operator" class="md-header__button md-logo" aria-label="Registry Operator" data-md-component="logo">
      
  <img src="../../../assets/package.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Registry Operator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Design Draft
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="326CE5" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="326CE5" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/registry-operator/registry-operator" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  Design

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting_started/0-introduction/" class="md-tabs__link">
          
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../reference/out/" class="md-tabs__link">
          
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Registry Operator" class="md-nav__button md-logo" aria-label="Registry Operator" data-md-component="logo">
      
  <img src="../../../assets/package.png" alt="logo">

    </a>
    Registry Operator
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/registry-operator/registry-operator" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Design
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Design Draft
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Design Draft
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      Problem Statement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mvp-minimum-viable-product" class="md-nav__link">
    <span class="md-ellipsis">
      MVP (Minimum Viable Product)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MVP (Minimum Viable Product)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-features" class="md-nav__link">
    <span class="md-ellipsis">
      Core Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-resource-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Resource Definitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Controller Logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-health-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Health Checks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deliverables" class="md-nav__link">
    <span class="md-ellipsis">
      Deliverables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps-post-mvp-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps (Post-MVP Enhancements)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Next Steps (Post-MVP Enhancements)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registry-template" class="md-nav__link">
    <span class="md-ellipsis">
      Registry Template
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Registry Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-through-cache" class="md-nav__link">
    <span class="md-ellipsis">
      Pull-through Cache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pull-through Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works_1" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-and-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Testing and Validation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-integrations" class="md-nav__link">
    <span class="md-ellipsis">
      Future Integrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Integrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#runbooks" class="md-nav__link">
    <span class="md-ellipsis">
      Runbooks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/0-introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/1-quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/out/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      Problem Statement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mvp-minimum-viable-product" class="md-nav__link">
    <span class="md-ellipsis">
      MVP (Minimum Viable Product)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MVP (Minimum Viable Product)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-features" class="md-nav__link">
    <span class="md-ellipsis">
      Core Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-resource-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Resource Definitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controller-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Controller Logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-health-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Health Checks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deliverables" class="md-nav__link">
    <span class="md-ellipsis">
      Deliverables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps-post-mvp-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps (Post-MVP Enhancements)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Next Steps (Post-MVP Enhancements)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registry-template" class="md-nav__link">
    <span class="md-ellipsis">
      Registry Template
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Registry Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-through-cache" class="md-nav__link">
    <span class="md-ellipsis">
      Pull-through Cache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pull-through Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works_1" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-and-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Testing and Validation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-integrations" class="md-nav__link">
    <span class="md-ellipsis">
      Future Integrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Integrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#runbooks" class="md-nav__link">
    <span class="md-ellipsis">
      Runbooks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Design Draft</h1>

<h2 id="overview">Overview</h2>
<p>The <strong>Registry Operator</strong> is being developed to simplify the management and operation of CNCF Distribution Registry instances within Kubernetes environments. It automates tasks such as deployment, scaling and upgrades of container image registries. By providing a streamlined and automated approach, the Registry Operator aims to enhance the developer and DevOps experience, reduce operational overhead, and ensure the registry remains highly available and performant.</p>
<h2 id="problem-statement">Problem Statement</h2>
<p>Managing stateful applications like container image registries manually in Kubernetes can be challenging due to various reasons:</p>
<ol>
<li>
<p><strong>Complexity in Configuration</strong>: Setting up and managing a container registry requires configuration of various components such as storage, networking, and access controls. Manually managing these configurations can lead to inconsistencies and errors.</p>
</li>
<li>
<p><strong>Scaling and Upgrades</strong>: Without an automated process, scaling registry instances or upgrading them becomes time-consuming and prone to downtime or misconfiguration.</p>
</li>
<li>
<p><strong>Monitoring and Alerts</strong>: Manually setting up monitoring for registry health and performance can be inefficient, and failure to detect issues early may result in downtime.</p>
</li>
</ol>
<p>The Registry Operator addresses these pain points by automating these tasks, ensuring reliable and efficient operation of container image registries in Kubernetes.</p>
<h2 id="objectives">Objectives</h2>
<p>The primary objectives of the <strong>Registry Operator</strong> are as follows:</p>
<ol>
<li>
<p><strong>Automate Deployment and Configuration</strong>: </p>
<ul>
<li>Simplify the process of deploying CNCF Distribution Registry instances by automating the configuration of storage, networking, and access controls.</li>
<li>Provide a declarative approach using Kubernetes Custom Resource Definitions (CRDs) to manage registry instances.</li>
</ul>
</li>
<li>
<p><strong>Seamless Scaling and Upgrades</strong>: </p>
<ul>
<li>Ensure that scaling the registry to meet demand can be done effortlessly, without manual intervention.</li>
<li>Support zero-downtime upgrades for registry instances, ensuring business continuity during version changes.</li>
</ul>
</li>
<li>
<p><strong>High Availability and Fault Tolerance</strong>:</p>
<ul>
<li>Ensure the registry remains highly available, even during node failures or resource limitations.</li>
<li>Build in self-healing mechanisms to automatically recover from common failure scenarios.</li>
</ul>
</li>
<li>
<p><strong>Monitoring and Alerting</strong>: </p>
<ul>
<li>Integrate with popular monitoring tools (e.g., Prometheus, Grafana) to provide real-time health metrics, performance monitoring, and usage statistics.</li>
<li>Automate alerting to notify administrators of critical issues before they impact operations.</li>
</ul>
</li>
<li>
<p><strong>Secure and Compliant Operations</strong>: </p>
<ul>
<li>Enforce security best practices for managing access controls, securing registry communication, and handling sensitive data.</li>
<li>Ensure compliance with industry standards and organizational policies for container registry management.</li>
</ul>
</li>
<li>
<p><strong>Ease of Use for DevOps Teams</strong>:</p>
<ul>
<li>Provide clear documentation and user-friendly interfaces for configuring and managing registry instances.</li>
<li>Offer seamless integration with CI/CD pipelines to enhance DevOps workflows, allowing quick and efficient management of container images.</li>
</ul>
</li>
</ol>
<h2 id="mvp-minimum-viable-product">MVP (Minimum Viable Product)</h2>
<h3 id="core-features">Core Features</h3>
<h4 id="custom-resource-definitions">Custom Resource Definitions</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nn">---</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry-operator.dev/v1alpha1</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Registry</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-registry</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">          </span><span class="c1"># Number of registry instances</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry:2</span><span class="w">    </span><span class="c1"># The container image for the registry</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">  </span><span class="nt">storage</span><span class="p">:</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span><span class="nt">bucketClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-s3-class</span><span class="w">              </span><span class="c1"># Name of the BucketClass for which the BucketClaim and Bucket are provisioned</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">    </span><span class="nt">bucketAccessClass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-s3-access-class</span><span class="w">     </span><span class="c1"># Name of the BucketAccessClass for which the BucketAccess and Secret are provisioned</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;500m&quot;</span><span class="w">      </span><span class="c1"># CPU resource requests</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1Gi&quot;</span><span class="w">    </span><span class="c1"># Memory resource requests</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="w">         </span><span class="c1"># CPU resource limits</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span><span class="w">    </span><span class="c1"># Memory resource limits</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">  </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span><span class="w">    </span><span class="c1"># Kubernetes service type (can be ClusterIP, NodePort, or LoadBalancer)</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span><span class="w">         </span><span class="c1"># Port for the registry service</span>
</span></code></pre></div>
<h4 id="controller-logic">Controller Logic</h4>
<p>The <strong>Registry Operator</strong> controller is designed to ensure that the state of the container registry aligns with the desired configuration specified in the <code>Registry</code> CRD. It continuously monitors the state of both the custom resource and its dependencies, performing reconciliation as necessary to maintain the desired state.</p>
<p><strong>Key Responsibilities</strong>:</p>
<ol>
<li>
<p><strong>Observe State</strong>:</p>
<ul>
<li>The controller continuously observes the state of the <code>Registry</code> CRD and its dependent resources, including Deployments, Services, etc.</li>
</ul>
</li>
<li>
<p><strong>Handle State Changes</strong>:</p>
<ul>
<li>When any observed resource changes state (e.g., due to updates, failures, or scaling events), the controller is notified and takes appropriate action to reconcile the state.</li>
</ul>
</li>
<li>
<p><strong>Reconcile State</strong>:</p>
<ul>
<li>The controller performs reconciliation operations to ensure that the actual state of the registry matches the desired state defined in the <code>Registry</code> CRD. This includes creating, updating, or deleting resources as necessary.</li>
</ul>
</li>
<li>
<p><strong>Integration with Dependencies</strong>:</p>
<ul>
<li>The controller manages the lifecycle of related Kubernetes resources:<ul>
<li><strong>Deployment</strong>: Ensures the registry pods are correctly deployed and scaled.</li>
<li><strong>Service</strong>: Manages access to the registry within the cluster.</li>
<li><strong>BucketClaim</strong> and <strong>BucketAccess</strong>: Manages storage for the registry.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>Sequence Diagram</strong>:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant CustomResource
    participant Controller
    participant BucketClaim
    participant BucketAccess
    participant Deployment
    participant Service

    Controller-&gt;&gt;CustomResource: observe state
    loop
        CustomResource--&gt;&gt;Controller: state change
        Controller-&gt;&gt;+BucketClaim: reconcile state
        BucketClaim--&gt;&gt;-Controller: desired state
        Controller-&gt;&gt;+BucketAccess: reconcile state
        BucketAccess--&gt;&gt;-Controller: desired state
        Controller-&gt;&gt;+Deployment: reconcile state
        Deployment--&gt;&gt;-Controller: desired state
        Controller-&gt;&gt;+Service: reconcile state
        Service--&gt;&gt;-Controller: desired state
    end</code></pre>
<p><strong>Workflow</strong>:</p>
<ol>
<li>
<p><strong>Initial Observation</strong>:</p>
<ul>
<li>The controller starts by observing the state of the <code>Registry</code> CRD and related resources. It monitors any changes or updates.</li>
</ul>
</li>
<li>
<p><strong>Reconciliation Loop</strong>:</p>
<ul>
<li>Whenever a state change is detected in the <code>Registry</code> CRD or its dependencies, the controller triggers a reconciliation loop.</li>
<li>In this loop, the controller:<ul>
<li>Updates or creates <code>BucketClaim</code> and <code>BucketAccess</code> resources to meet the storage requirements.</li>
<li>Adjusts the <code>Deployment</code> to ensure the registry pods are running as desired.</li>
<li>Configures the <code>Service</code> to provide access to the registry.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Ensure Desired State</strong>:</p>
<ul>
<li>The controller continuously ensures that all related resources align with the desired state specified in the <code>Registry</code> CRD.</li>
</ul>
</li>
</ol>
<h4 id="basic-health-checks">Basic Health Checks</h4>
<p><strong>Basic Health Checks</strong> are crucial for ensuring that the container registry is operational and performing as expected. For the MVP, the health check mechanisms will include:</p>
<ol>
<li>
<p><strong>Pod Health Checks</strong>:</p>
<ul>
<li><strong>Liveness Probes</strong>: The controller will ensure that the registry pods have liveness probes configured. These probes will periodically check that the registry service is running and responsive.</li>
<li><strong>Readiness Probes</strong>: The controller will also configure readiness probes to ensure that the registry pods are ready to serve traffic before routing requests to them.</li>
</ul>
</li>
<li>
<p><strong>Service Health Checks</strong>:</p>
<ul>
<li><strong>Service Availability</strong>: The controller will check that the Kubernetes Service for the registry is correctly exposing the registry pods and that the service endpoints are available.</li>
</ul>
</li>
<li>
<p><strong>Custom Metrics</strong>:</p>
<ul>
<li><strong>Basic Metrics Collection</strong>: The operator will expose basic metrics (e.g., request count, error rate) that can be collected by monitoring systems like Prometheus. These metrics will help in identifying potential issues and monitoring the overall health of the registry.</li>
</ul>
</li>
</ol>
<pre class="mermaid"><code>graph TD
    A[Pod Health Checks]
    A --&gt; B[Liveness Probes]
    A --&gt; C[Readiness Probes]

    D[Service Health Checks] --&gt; E[Service Availability]

    G[Custom Metrics] --&gt; H[Basic Metrics Collection]</code></pre>
<h3 id="deliverables">Deliverables</h3>
<ul>
<li>Deployed operator with CRD definitions and basic lifecycle management.</li>
<li>Documentation and user guides for deploying and using the operator.</li>
<li>Initial test suite for core features.</li>
</ul>
<h2 id="next-steps-post-mvp-enhancements">Next Steps (Post-MVP Enhancements)</h2>
<h3 id="registry-template">Registry Template</h3>
<p>To enhance flexibility and reduce duplication, the operator can introduce a <code>RegistryTemplate</code> CRD. This allows defining common configuration settings in a template that can be referenced and overridden in individual <code>Registry</code> instances.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nn">---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry-operator.dev/v1alpha1</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RegistryTemplate</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-registry-template</span><span class="w">  </span><span class="c1"># Global template name, not namespaced</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">                 </span><span class="c1"># Default number of registry instances</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry:2</span><span class="w">           </span><span class="c1"># Default container image for the registry</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span><span class="nt">storage</span><span class="p">:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="nt">bucketClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-s3-class</span><span class="w">              </span><span class="c1"># Name of the BucketClass for which the BucketClaim and Bucket are provisioned</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="nt">bucketAccessClass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-s3-access-class</span><span class="w">     </span><span class="c1"># Name of the BucketAccessClass for which the BucketAccess and Secret are provisioned</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;500m&quot;</span><span class="w">      </span><span class="c1"># Default CPU resource requests</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1Gi&quot;</span><span class="w">    </span><span class="c1"># Default memory resource requests</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">    </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="w">         </span><span class="c1"># Default CPU resource limits</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span><span class="w">    </span><span class="c1"># Default memory resource limits</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">  </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span><span class="w">    </span><span class="c1"># Default service type</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span><span class="w">         </span><span class="c1"># Default port for the service</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="nn">---</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry-operator.dev/v1alpha1</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Registry</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-registry</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-registry-template</span><span class="w"> </span><span class="c1"># Reference to the global template</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w">          </span><span class="c1"># Override default replicas</span>
</span></code></pre></div>
<h4 id="how-it-works">How It Works:</h4>
<ol>
<li>
<p><strong>Define Template</strong>: Create a <code>RegistryTemplate</code> resource that includes common settings and defaults for the registry.</p>
</li>
<li>
<p><strong>Reference Template</strong>: Create <code>Registry</code> resources that reference the <code>RegistryTemplate</code> by name. Specific fields in the <code>Registry</code> CRD can override default values defined in the template.</p>
</li>
<li>
<p><strong>Apply Overrides</strong>: The operator applies the template values and overrides from the <code>Registry</code> specification to configure the registry instances.</p>
</li>
</ol>
<p>This approach streamlines configuration management, reduces duplication, and provides a centralized way to manage common settings for multiple registry instances.</p>
<h3 id="pull-through-cache">Pull-through Cache</h3>
<p>To support pull-through caching for container images, the <strong>Registry Operator</strong> will introduce a <code>Cache</code> resource. This resource will allow configuring an external cache for registry images, enabling the registry to cache and serve images from a specified upstream registry.</p>
<p>For the MVP, the pull-through cache only supports using an empty path volume, and does not support PersistentVolumeClaims (PVCs) or object storage solutions.</p>
<p><strong>Cache CRD Definition</strong>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nn">---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry-operator.dev/v1alpha1</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cache</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-cache</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="c1"># URL of the upstream registry to cache images from</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="nt">upstreamRegistryURL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://my-upstream-registry.com&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">  </span><span class="c1"># Configuration for the cache volume</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">  </span><span class="nt">volume</span><span class="p">:</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emptyDir</span><span class="w">       </span><span class="c1"># Type of volume used for caching (supports ONLY emptyDir)</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50Gi</span><span class="w">           </span><span class="c1"># Size of the volume (optional, for reference)</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span><span class="w"> </span><span class="c1"># Access mode for the volume (optional, for reference)</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">  </span><span class="c1"># Optional configurations for cache behavior</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">  </span><span class="nt">cacheTTL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;24h&quot;</span><span class="w">       </span><span class="c1"># Time-to-live for cached images</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">  </span><span class="nt">maxCacheSize</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;100Gi&quot;</span><span class="w"> </span><span class="c1"># Maximum cache size</span>
</span></code></pre></div>
<h4 id="how-it-works_1">How It Works:</h4>
<ol>
<li>
<p><strong>Cache Configuration</strong>:</p>
<ul>
<li>Define a <code>Cache</code> resource with the URL of the upstream registry and the volume configuration. The registry operator will set up the cache based on this configuration.</li>
</ul>
</li>
<li>
<p><strong>Image Caching</strong>:</p>
<ul>
<li>When a request for an image is made, the registry will first check the cache. If the image is not present in the cache, it will be pulled from the upstream registry and stored in the cache.</li>
</ul>
</li>
<li>
<p><strong>Cache Management</strong>:</p>
<ul>
<li>The operator manages the cache based on the TTL and size settings. Cached images will be refreshed or removed according to these policies.</li>
</ul>
</li>
<li>
<p><strong>Volume Handling</strong>:</p>
<ul>
<li>The <code>emptyDir</code> volume provides a temporary storage space for cached images.</li>
</ul>
</li>
</ol>
<h3 id="advanced-features">Advanced Features</h3>
<ol>
<li>
<p><strong>Automated Upgrades</strong></p>
<ul>
<li>Support rolling updates for application deployments.</li>
<li><strong>Strategy for Automating Application Upgrades</strong>:<ul>
<li>The operator will leverage Kubernetes' built-in rolling update mechanism to ensure minimal disruption during upgrades.</li>
<li>A phased approach will be adopted:<ol>
<li><strong>Version Validation</strong>: The operator will first validate the target version to ensure compatibility with the current registry setup.</li>
<li><strong>Health Checks</strong>: Post-upgrade, the operator will perform health checks on each instance to ensure that it has been upgraded successfully and is functioning as expected.</li>
<li><strong>Rollback Mechanism</strong>: In case of any issues during the upgrade process, the operator will support automatic rollback to a previous stable version to ensure continuity of service.</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Use Redis (or OSS alternative) as a metadata cache</strong></p>
<ul>
<li>By default, the registry stores layer metadata in an in-memory map. The operator will add support for configuring Redis or compatible open-source alternatives (e.g., <strong>Valkey</strong>, <strong>Garnet</strong>, <strong>Dragonfly</strong>, <strong>KeyDB</strong>) to store and access metadata.</li>
<li><strong>Benefits</strong>:<ul>
<li>Improved performance in multi-instance, high-availability (HA) setups by externalizing the metadata store.</li>
<li>Redis or its alternatives provide persistent storage of metadata, reducing the overhead on memory usage in long-running deployments.</li>
</ul>
</li>
<li><strong>Optional Redis Deployment</strong>:<ul>
<li>If a Redis (or compatible store) is not already available, the operator can optionally provision one in the cluster.</li>
<li>The Redis service can be deployed with high-availability configurations as needed by the registry's workload.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Provision TLS certificates with cert-manager</strong></p>
<ul>
<li>The operator will integrate with <strong>cert-manager</strong> to provision and manage TLS certificates automatically.</li>
<li><strong>Key Details</strong>:<ul>
<li>Cert-manager will issue certificates for the registry Ingress, ensuring secure HTTPS communication.</li>
<li>The operator will manage certificate renewal and ensure that the registry always has a valid TLS certificate.</li>
<li>Certificates can be automatically rotated when they expire or are nearing expiration.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Provision local storage for the registry with filesystem storage</strong></p>
<ul>
<li>The operator will support configuring the registry to use local storage through <strong>PersistentVolumeClaims (PVCs)</strong> with filesystem storage.</li>
<li>
<p><strong>Use Case</strong>:</p>
<ul>
<li>While PVC-based filesystem storage does not allow for HA deployments due to its stateful nature, it is still useful for certain registry setups, such as <strong>pull-through caches</strong>. This is particularly beneficial when high-performance local storage is provisioned.</li>
<li>This feature is especially helpful for environments where HA is not a strict requirement or for scenarios requiring fast, local storage for cached images.</li>
</ul>
</li>
<li>
<p><strong>Configuration</strong>:</p>
<ul>
<li>The operator will allow specifying a PVC for the registry, which will be automatically created and bound to the registry deployment.</li>
<li>If using filesystem storage, the operator will ensure that the deployment is properly configured to avoid conflicts with HA setups, such as ensuring that the replica count is set to 1 for non-distributed setups.</li>
<li>The filesystem storage option provides a simplified, cost-effective approach for users needing local caching.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>These advanced features will enhance the registry operator’s flexibility, supporting more complex deployment scenarios and advanced caching mechanisms to optimize performance and reliability.</p>
<h3 id="testing-and-validation">Testing and Validation</h3>
<p>To ensure the <strong>Registry Operator</strong> is robust, scalable, and reliable, comprehensive testing will be conducted post-MVP. The testing strategy will focus on covering edge cases, scaling scenarios, and integration points with Kubernetes.</p>
<ol>
<li>
<p><strong>Comprehensive Testing Strategy</strong>:</p>
<ul>
<li><strong>Unit Testing</strong>: <ul>
<li>Each operator function (e.g., deployment, backup, scaling) will be unit tested to ensure individual components work as expected.</li>
</ul>
</li>
<li><strong>Integration Testing</strong>:<ul>
<li>Test interactions between the operator and Kubernetes components (e.g., CRDs, controllers, volumes).</li>
<li>Validate the operator's integration with external tools such as monitoring systems (e.g., Prometheus), cloud storage, and CI/CD pipelines.</li>
</ul>
</li>
<li><strong>Edge Case Testing</strong>:<ul>
<li>Simulate scenarios such as node failures, storage disruptions, and misconfigurations to ensure the operator can handle and recover from such events.</li>
<li>Test operator behavior during network outages or degraded performance to ensure high availability mechanisms are functioning properly.</li>
</ul>
</li>
<li><strong>Scaling Tests</strong>:<ul>
<li>Validate the operator’s ability to scale the registry horizontally to meet increased demand.</li>
<li>Test for resource exhaustion scenarios (e.g., when CPU, memory, or storage limits are reached) to ensure that scaling, alerting, and self-healing mechanisms work correctly.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>End-to-End (E2E) Testing with Kyverno Chainsaw</strong>:</p>
<ul>
<li><strong>Kyverno Chainsaw</strong> will be used for E2E testing to simulate real-world registry operations, ensuring that the entire lifecycle of the registry is properly validated. This includes:<ul>
<li><strong>Automated Deployments</strong>: Testing the full deployment flow of the registry from configuration to startup.</li>
<li><strong>Scaling and Upgrades</strong>: Verifying that the operator can handle rolling upgrades and scaling operations without downtime.</li>
<li><strong>Backup and Recovery</strong>: Ensuring that snapshot creation, backup storage, and recovery functions work as intended in various scenarios.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Performance and Load Testing</strong>:</p>
<ul>
<li>Simulate high traffic and large-scale operations to measure performance and resource utilization.</li>
<li>Ensure the operator can maintain acceptable performance levels under heavy load, large numbers of container images, or numerous concurrent users.</li>
</ul>
</li>
</ol>
<h2 id="future-integrations">Future Integrations</h2>
<h3 id="runbooks">Runbooks</h3>
<ol>
<li>
<p><strong>Authentication</strong></p>
<ul>
<li>The operator will integrate with common authentication mechanisms such as OAuth2, LDAP, and Kubernetes secrets for secure access to the container registry. It will manage authentication configurations and ensure that users and services can interact securely with the registry. Future plans include:<ul>
<li>Support for token-based authentication.</li>
<li>Automated management of credentials and certificates.</li>
<li>Integration with Kubernetes Role-Based Access Control (RBAC) for fine-grained access control.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Integration with UI</strong></p>
<ul>
<li>The operator will integrate with the <a href="https://github.com/Joxit/docker-registry-ui">Docker Registry UI</a>, providing a graphical interface for managing and browsing container images. This integration will allow users to:<ul>
<li>View and manage image tags.</li>
<li>Monitor registry activity and status through the UI.</li>
<li>Perform image lifecycle management (e.g., deletion, retagging) directly from the interface.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Integration with ImagePuller Operator</strong></p>
<ul>
<li>The Registry Operator will integrate with the <a href="https://github.com/che-incubator/kubernetes-image-puller-operator">ImagePuller Operator</a>, which pre-pulls container images into Kubernetes clusters for faster deployments. The key benefits of this integration include:<ul>
<li>Coordinated image management between the registry and clusters, ensuring that images are available where and when needed.</li>
<li>Enhanced efficiency by reducing the time required to pull images during deployment.</li>
<li>Automated syncing of images between the registry and Kubernetes nodes.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Alerting and Prometheus Integration</strong></p>
<ul>
<li>The Registry Operator will be integrated with Prometheus for real-time monitoring and alerting. Key metrics like registry availability, image pull times, disk usage, and error rates will be exposed. Future plans include:<ul>
<li>Configurable alert thresholds for key metrics, ensuring that operators are notified of potential issues before they impact the system.</li>
<li>Alerts for critical events like image pull failures, storage limits, and registry health.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Grafana Dashboards</strong></p>
<ul>
<li>The operator will include pre-configured Grafana dashboards to visualize registry performance, usage, and health. These dashboards will offer:<ul>
<li>Real-time views of registry traffic, including image pulls and pushes.</li>
<li>Insights into resource utilization (e.g., CPU, memory, disk usage).</li>
<li>Historical trends to help operators understand usage patterns and anticipate future needs.</li>
<li>Customizable panels for specific metrics that align with the organization’s monitoring requirements.</li>
</ul>
</li>
</ul>
</li>
</ol>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; <script>
  document.write(new Date().getFullYear())
</script> Registry Operator contributors
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "header.autohide", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>